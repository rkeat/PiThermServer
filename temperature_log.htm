<!DOCTYPE html>
<html>
	<head>
		<title>[BLt] Logged Temperature</title>
   	<meta name="description" content="Plot of temperature from DS18B20 sensor connected to Raspberry Pi">
	   <meta name="author" content="Tom Holderness">
	   <meta name="version" content="0.1">
		<script src="http://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
		<script src="http://code.highcharts.com/highcharts.js" type="text/javascript"></script>
		<script type="text/javascript">

      var chart; // global chart variable
      // Get data from server in JSON format (query time series when sensor was outside).
      function getData(){
         $.getJSON('/temperature_query.json?num_obs=-1&start_date=2013-01-23T16:00', function(data){
            var series = [{
               id: 'series1',
               name: 'Sensor#1 Fermenter (\u00B10.5\u00B0C)',
               type: 'spline',
               data: []
               },
               {
               id: 'series2',
               name: 'Sensor#2 Chamber (\u00B10.5\u00B0C)',
               type: 'spline',
               data: []
               },
               {
               id: 'series3',
               name: 'Sensor#3 Room (\u00B10.5\u00B0C)',
               type: 'spline',
               data: []
               }];
            var i = 0;
						var date = new Date();
						// Get timezone offset and convert to milliseconds
						var tz = date.getTimezoneOffset () * 60000; // one zero more because (sec in min * ms in sec ==> (60 * 1000))

            // Iterate JSON data series and add to plot
            while (data.temperature_record[0][i])
            {
               series[0].data.push([(data.temperature_record[0][i].unix_time)-tz, data.temperature_record[0][i].Fermenter]);
               series[1].data.push([(data.temperature_record[0][i].unix_time)-tz, data.temperature_record[0][i].Chamber]);
               series[2].data.push([(data.temperature_record[0][i].unix_time)-tz, data.temperature_record[0][i].Room]);
               i++;
            }
         chart.addSeries(series[0]);
         chart.addSeries(series[1]);
         chart.addSeries(series[2]);
         });
      }
	</script>

   <script type="text/javascript">
   // Configure the plot
   $(document).ready(function() {
      chart = new Highcharts.Chart({
         chart: {
            renderTo: 'container',
            //type: 'spline',
            zoomType: 'x',
            spaceRight: 20,
            events: {load: getData()}
               },
        title: {
		       text: '[BrewLab Tokyo] Fermentation Log '},
        subtitle: {
                text: 'Click and drag in the plot area to zoom in',
                align: 'right',
               },

        xAxis: {
		       type: 'datetime',
		       tickPixelInterval: 150,
		       maxZoom: 20 * 1000,
		       title: {
			      text: 'Time',
			      margin: 15
			   }},
         yAxis: {
		       minPadding: 0.2,
		       maxPadding: 0.2,
             showFirstLabel: false,
		       title: {
		           text: 'Temperature \u00B0C',
		           margin: 15
		       }},
             plotOptions: {},
         })
   });
	</script>
	</head>

	<body bgcolor="">
	<div id="container" style="width: 100%; height: 400px"></div>
	</body>
</html>
